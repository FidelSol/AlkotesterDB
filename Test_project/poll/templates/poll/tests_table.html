<!doctype html>
<html lang="en">
 <head>
<meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
<link href="https://unpkg.com/bootstrap-table@1.18.1/dist/bootstrap-table.min.css" rel="stylesheet">
</head>
 <body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://unpkg.com/tableexport.jquery.plugin/tableExport.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.1/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.1/dist/bootstrap-table-locale-all.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.18.1/locale/bootstrap-table-ru-RU.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.1/dist/extensions/export/bootstrap-table-export.min.js"></script>

<style>
  .select,
  #locale {
    width: 100%;
  }
  .like {
    margin-right: 10px;
  }
</style>

<br>
<br><br>
<div class="select">
  <select class="form-control" id="locale">
    <option value="af-ZA">af-ZA</option>
    <option value="ar-SA">ar-SA</option>
    <option value="ca-ES">ca-ES</option>
    <option value="cs-CZ">cs-CZ</option>
    <option value="da-DK">da-DK</option>
    <option value="de-DE">de-DE</option>
    <option value="el-GR">el-GR</option>
    <option value="en-US" selected>en-US</option>
    <option value="es-AR">es-AR</option>
    <option value="es-CL">es-CL</option>
    <option value="es-CR">es-CR</option>
    <option value="es-ES">es-ES</option>
    <option value="es-MX">es-MX</option>
    <option value="es-NI">es-NI</option>
    <option value="es-SP">es-SP</option>
    <option value="et-EE">et-EE</option>
    <option value="eu-EU">eu-EU</option>
    <option value="fa-IR">fa-IR</option>
    <option value="fi-FI">fi-FI</option>
    <option value="fr-BE">fr-BE</option>
    <option value="fr-FR">fr-FR</option>
    <option value="he-IL">he-IL</option>
    <option value="hr-HR">hr-HR</option>
    <option value="hu-HU">hu-HU</option>
    <option value="id-ID">id-ID</option>
    <option value="it-IT">it-IT</option>
    <option value="ja-JP">ja-JP</option>
    <option value="ka-GE">ka-GE</option>
    <option value="ko-KR">ko-KR</option>
    <option value="ms-MY">ms-MY</option>
    <option value="nb-NO">nb-NO</option>
    <option value="nl-NL">nl-NL</option>
    <option value="pl-PL">pl-PL</option>
    <option value="pt-BR">pt-BR</option>
    <option value="pt-PT">pt-PT</option>
    <option value="ro-RO">ro-RO</option>
    <option value="ru-RU">ru-RU</option>
    <option value="sk-SK">sk-SK</option>
    <option value="sv-SE">sv-SE</option>
    <option value="th-TH">th-TH</option>
    <option value="tr-TR">tr-TR</option>
    <option value="uk-UA">uk-UA</option>
    <option value="ur-PK">ur-PK</option>
    <option value="uz-Latn-UZ">uz-Latn-UZ</option>
    <option value="vi-VN">vi-VN</option>
    <option value="zh-CN">zh-CN</option>
    <option value="zh-TW">zh-TW</option>
  </select>
</div>







<div id="toolbar">
  <button id="remove" class="btn btn-danger" disabled>
    <i class="fa fa-trash"></i> Delete
  </button>

  <button id="button" class="btn btn-secondary">Добавить</button>
  <button id="button_load" class="btn btn-secondary">Загрузить</button>
</div>



  <form class="px-4 py-3" method="post" id="ajax_form" action="">
    <div class="input-group mb-3">
    <div class="row">

      <div class="col">
          <input type="number" class="form-control" name="tests_id" placeholder="tests_id" /><br>
      </div>

      <div class="col">
          <input type="number" class="form-control" name="personal_id" placeholder="personal_id" /><br>
      </div>

      <div class="col">

      </div>

      <div class="col">

      </div>

      <div class="col">
        <input type="checkbox" class="form-control" name="result" placeholder="result" /><br>
      </div>

      <div class="col">
        <input type="button" class="btn btn-primary" id="btn" value="Добавить" />
      </div>

    </div>
    </div>
  </form>


<div id="result_form"></div>

<table
  id="table"
  data-toggle="table"
  data-toolbar="#toolbar"
  data-search="true"
  data-show-refresh="true"
  data-show-toggle="true"
  data-show-fullscreen="true"
  data-show-columns="true"
  data-show-columns-toggle-all="true"
  data-detail-view="true"
  data-show-export="true"
  data-click-to-select="true"
  data-detail-formatter="detailFormatter"
  data-minimum-count-columns="2"
  data-show-pagination-switch="true"
  data-pagination="true"
  data-id-field="tests_id"
  data-page-list="[10, 25, 50, 100, all]"
  data-show-footer="true"
  data-side-pagination="server"
  data-url="{% url 'Tests-list' %}"


  data-buttons="buttons"

  data-response-handler="responseHandler">


</table>



<script type="text/javascript">
    var $table = $('#table')
    var $remove = $('#remove')
    var selections = []
     var $button = $('#button')
     var $button_load = $('#button_load')

    function getIdSelections() {
    return $.map($table.bootstrapTable('getSelections'), function (row) {
      return row.tests_id
        })
    }

    function responseHandler(res) {
    $.each(res.rows, function (i, row) {
      row.state = $.inArray(row.tests_id, selections) !== -1
    })
    return res
    }

    function detailFormatter(index, row) {
    var html = []
    $.each(row, function (key, value) {
      html.push('<p><b>' + key + ':</b> ' + value + '</p>')
    })
    return html.join('')
    }

    function operateFormatter(value, row, index) {
    return [
      '<a class="like" href="javascript:void(0)" title="Like">',
      '<i class="fa fa-heart"></i>',
      '</a>  ',
      '<a class="remove" href="javascript:void(0)" title="Remove">',
      '<i class="fa fa-trash"></i>',
      '</a>'
    ].join('')
    }

    window.operateEvents = {
    'click .like': function (e, value, row, index) {
      alert('You click like action, row: ' + JSON.stringify(row))
    },
    'click .remove': function (e, value, row, index) {
        $.ajax({
          url: "/api/v1/tests/" + row.tests_id +"/",
          method: "delete",
          dataType: "json",
          success: function(){
                 $table.bootstrapTable('remove', {
                 field: 'tests_id',
                 values: [row.tests_id], }),
		         alert("Удалить получилось!");}
          })
    }}


 function initTable() {
    $table.bootstrapTable('destroy').bootstrapTable({
    height: 550,
    locale: $('#locale').val(),
    columns: [
        [{
          field: 'state',
          checkbox: true,
          rowspan: 2,
          align: 'center',
          valign: 'middle'
        },{
            field: 'tests_id',
            title: 'Tests ID',
            rowspan: 2,
            align: 'center',
            valign: 'middle',
            sortable: true,
        }, {
          title: 'Tests Detail',
          colspan: 5,
          align: 'center'
        }],
        [{
            field: 'personal_id',
            title: 'Personal ID',
            sortable: true,
            align: 'center',
        },{
            field: 'expected_time',
            title: 'expected_time',
            sortable: true,
            align: 'center',
        },{
            field: 'result_time',
            title: 'result_time',
            sortable: true,
            align: 'center',
        },{
            field: 'result',
            title: 'result',
            sortable: true,
            align: 'center',
        },{
            field: 'operate',
            title: 'Item Operate',
            align: 'center',
            clickToSelect: false,
            events: window.operateEvents,
            formatter: operateFormatter
        }]
       ]
      })

 $table.on('check.bs.table uncheck.bs.table ' +
      'check-all.bs.table uncheck-all.bs.table',
    function () {
      $remove.prop('disabled', !$table.bootstrapTable('getSelections').length)
        selections = getIdSelections()
      })






 $table.on('all.bs.table', function (e, name, args) {
      console.log(name, args)
    })

 $remove.click(function () {
               var ids = getIdSelections()


 ids.forEach(function(value, index, ids) {
        $.ajax({
          url: "/api/v1/tests/" + ids[index] +"/",
          method: "delete",
          dataType: "json",
          success: function(){
            $table.bootstrapTable('remove', {
              field: 'tests_id',
              values: ids,
            })
          }
        })
 })

  $remove.prop('disabled', true)

})
}






$( document ).ready(function() {
    $("#btn").click(
		function(){
			sendAjaxForm('result_form', 'ajax_form', "/api/v1/tests/");
			return false;
		}
	);
});

function sendAjaxForm(result_form, ajax_form, url) {
    $.ajax({
        url: "/api/v1/tests/",
        type: "POST",
        dataType: "html",
        data: $("#"+ajax_form).serialize(),
        success: function(response) {
        	result = $.parseJSON(response);
        	$('#result_form').html('EEEEE');
    	},
    	error: function(response) {
            $('#result_form').html('Ошибка. Данные не отправлены.');
    	}
 	});
}



 $(function() {
    $button.click(function () {
     var user_answer_1 = prompt("Введите tests_id: ")
      var user_answer_2 = prompt("Введите personal_id: ")
      var user_answer_3 = prompt("Введите expected_time: ")
      var user_answer_4 = prompt("Введите result_time: ")
      var user_answer_5 = prompt("Введите result: ")
      $table.bootstrapTable('insertRow', {
        index: 0,
        row: {
          tests_id: user_answer_1,
          personal_id: user_answer_2,
          expected_time: user_answer_3 ,
          result_time: user_answer_4,
          result: user_answer_5,
          operate: 'operate',
        }
      })
    })
  })

  $(function() {
    $button_load.click(function () {
    var user_answer_1 = prompt("Введите tests_id: ")
      var user_answer_2 = prompt("Введите personal_id: ")
      var user_answer_3 = prompt("Введите expected_time: ")
      var user_answer_4 = prompt("Введите result_time: ")
      var user_answer_5 = prompt("Введите result: ")
          $.ajax({
                url: "/api/v1/tests/",
                type: "POST",
                dataType: "json",

                data: JSON.stringify(({tests_id: $(user_answer_1),
                        personal_id: $(user_answer_2),
                        expected_time: $(user_answer_3) ,
                        result_time: $(user_answer_4),
                        result: $(user_answer_5)}).serialize()),
                success: function(data) {
        	      result = $.parseJSON(data);
        	      alert('EEEEE');
    	        },
    	        error: function(response) {
                  alert('Не отправлено!');
    	        }
 	      });

    })
  })





$(function() {
    initTable()

    $('#locale').change(initTable)
  })

  </script>
</body>
</html>