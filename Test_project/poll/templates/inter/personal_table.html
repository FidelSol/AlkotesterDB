<!doctype html>
<html lang="en">
 <head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
     <meta name="generator" content="Jekyll v4.1.1">
     <meta name="msapplication-config" content="https://getbootstrap.com/docs/4.5/assets/img/favicons/browserconfig.xml">
        <meta name="theme-color" content="#563d7c">
        {% load static %}
     <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/dashboard/">
<link href="{% static 'poll/css/dashboard.css' %}" rel="stylesheet">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
<link href="https://unpkg.com/bootstrap-table@1.18.1/dist/bootstrap-table.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="http://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/css/tempusdominus-bootstrap-4.min.css" integrity="sha256-XPTBwC3SBoWHSmKasAk01c08M6sIA5gF5+sRxqak2Qs=" crossorigin="anonymous">
<link rel="icon" href="https://getbootstrap.com/docs/4.5/assets/img/favicons/favicon.ico">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
 <script src="http://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://unpkg.com/tableexport.jquery.plugin/tableExport.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.1/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.1/dist/bootstrap-table-locale-all.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.18.1/locale/bootstrap-table-ru-RU.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.1/dist/extensions/export/bootstrap-table-export.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/js/tempusdominus-bootstrap-4.min.js" integrity="sha256-z0oKYg6xiLq3yJGsp/LsY9XykbweQlHl42jHv2XTBz4=" crossorigin="anonymous"></script>

<style type="text/css">
@-webkit-keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}@keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}.chartjs-render-monitor{-webkit-animation:chartjs-render-animation 0.001s;animation:chartjs-render-animation 0.001s;}

.select,
  #locale {
  width: 100%;
  }
.like {
  margin-right: 10px;
  }
.form-group {
  width: 100%;
  height: 100%;
table {
  border-collapse: collapse;
  border-spacing: 0;
  width: 100%;
  border: 1px solid #ddd;
}
th, td {
  text-align: center;
  padding: 16px;
}
th:first-child, td:first-child {
  text-align: left;
}
tr:nth-child(even) {
  background-color: #f2f2f2
}
.fa-exclamation {
  color: red;
}
</style>
</head>

<body>
<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="{% url 'index' %}">База результатов тестирования</a>

  <ul class="navbar-nav px-3">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Авторизация</a>
        <div class="dropdown-menu">
            <a class="dropdown-item" href="{% url 'logged_out' %}">Выйти</a>
          <a class="dropdown-item" href="{% url 'password_reset' %}">Сбросить пароль</a>
      </div>
      </li>
  </ul>
    </nav>

<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
      <div class="sidebar-sticky pt-3">
        <ul class="nav flex-column">

          <li class="nav-item">
            <a class="nav-link" href="{% url 'index' %}">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
              Общий список сотрудников
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="{% url 'fail' %}">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
              Список сотрудников, проваливших тест
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="{% url 'add_p' %}">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-layers"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
              Добавить сотрудника
            </a>
          </li>

            <li class="nav-item">
            <a class="nav-link" href="{% url 'add_t' %}">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-layers"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
              Добавить тесты
            </a>
          </li>

             <li class="nav-item">
            <a class="nav-link" href="{% url 'personals' %}">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-layers"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
              Таблица сотрудников
            </a>
          </li>


             <li class="nav-item">
            <a class="nav-link" href="{% url 'tests' %}">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-layers"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
              Таблица тестов
            </a>
          </li>
        </ul>
      </div>
    </nav>

<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4"><div class="chartjs-size-monitor" style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;"><div class="chartjs-size-monitor-expand" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div></div><div class="chartjs-size-monitor-shrink" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:200%;height:200%;left:0; top:0"></div></div></div>

<table style="border-collapse: collapse;
  border-spacing: 0;
  width: 100%;
  border: 1px solid #ddd;">
    <tr style="background-color: #f2f2f2"><th colspan="3" style="text-align: center">ПЕРСОНАЛ</th></tr>
    <tr style="background-color: #f2f2f2">
      <th style="width:32%; text-align: center;
  padding: 16px;">Сотрудников всего</th>
      <th style="width:32%; text-align: center;
  padding: 16px;">Сотрудников, проваливших тесты<i class="fa fa-remove" style="color: red;"></i></th>
        <th style="width:32%; text-align: center;
  padding: 16px;">Всего дисциплинарных взысканий<i class="fa fa-exclamation" style="color: red;"></i></th>
    </tr>
    <tr>
      <td style="text-align: center;
  padding: 16px;"><div id="count"></div></td>
        <td style="text-align: center;
  padding: 16px;">{{ f }}</td>
      <td style="text-align: center;
  padding: 16px;"><div id="punish"></div></td>
    </tr>
</table>

<br>
<div class="select">
  <select class="form-control" id="locale">
    <option value="en-US" selected>en-US</option>
    <option value="ru-RU">ru-RU</option>
  </select>
</div>
<br>
<div id="toolbar">
    <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">

<div class="btn-group mr-2" role="group" aria-label="First group">
  <button id="remove" class="btn btn-danger" disabled>
    <i class="fa fa-trash"></i> Delete
  </button>
</div>

<div class="btn-group mr-2" role="group" aria-label="Second group">
<div class="dropdown mr-4">
    <button type="button" class="btn btn-secondary dropdown-toggle" style="width: 200px;" id="dropdownMenuOffset" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-offset="10,20">
      Загрузить
    </button>
<div class="dropdown-menu">
  <form class="px-4 py-3" method="post" id="ajax_form" enctype="multipart/form-data" action="">
    {% csrf_token %}

        <div class="form-group">
          <input type="number" class="form-control" name="ext_id" placeholder="Расшир. ID" /><br>
        </div>

        <div class="form-group">
        <input type="text" class="form-control" name="full_name" placeholder="ФИО">
        </div>

        <div class="form-group">
          <div class="input-group date" id="datetimepicker1" data-target-input="nearest">
                    <input type="text" class="form-control datetimepicker-input" name="birth_date" data-target="#datetimepicker1" placeholder="Дата рождения"/>
                    <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                    </div></div>
        </div>


        <div class="form-group">
        <input type="text" class="form-control" name="position" placeholder="Должность">
        </div>

        <div class="form-group">
        <input type="text" class="form-control" name="punishment" placeholder="Взыскания">
        </div>

        <input type="submit" class="btn btn-primary" id="btn" value="Загрузить" />

  </form>
</div>
</div>
</div>

<div class="btn-group" role="group" aria-label="Third group">
<div class="dropdown mr-4">
    <button type="button" class="btn btn-secondary dropdown-toggle" style="width: 200px;" id="dropdownMenuOffset_put" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-offset="10,20">
      Изменить
    </button>
<div class="dropdown-menu">
  <form class="px-4 py-3" method="post" id="ajax_put" enctype="multipart/form-data" action="">

      <input type="hidden" name="_method" value="PUT">
      {% csrf_token %}
        <div class="form-group">
          <input type="number" class="form-control" id="ext_id_put" name="ext_id_put" placeholder="Расшир. ID" /><br>
        </div>

        <div class="form-group">
        <input type="text" class="form-control" id="full_name_put" name="full_name_put" placeholder="ФИО">
        </div>

        <div class="form-group">
          <div class="input-group date" id="datetimepicker2" data-target-input="nearest">
                    <input type="text" class="form-control datetimepicker-input" id="birth_date_put" name="birth_date_put" data-target="#datetimepicker2" placeholder="Дата рождения"/>
                    <div class="input-group-append" data-target="#datetimepicker2" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                    </div></div>
        </div>


        <div class="form-group">
        <input type="text" class="form-control" id="position_put" name="position_put" placeholder="Должность">
        </div>

        <div class="form-group">
        <input type="text" class="form-control" id="punishment_put" name="punishment_put" placeholder="Взыскания">
        </div>



        <input type="submit" class="btn btn-primary" id="btn_put" value="Изменить" />

  </form>
</div>
</div>
</div>

        <div class="btn-group mr-2" role="group" aria-label="Forth group">
        <button id="button" class="btn btn-secondary">Кто провалил тесты</button>
        </div>

         <div class="btn-group mr-2" role="group" aria-label="Fifth group">
            <div class="input-group"> <span class="input-group-addon"></span>
            <input id="filter" type="text" class="form-control" placeholder="Поиск">
            </div>
          </div>
</div>
</div>


<table
  id="table"
  data-toggle="table"
  data-toolbar="#toolbar"
  data-search="false"
  data-show-refresh="true"
  data-show-toggle="true"
  data-show-fullscreen="true"
  data-show-columns="true"
  data-show-columns-toggle-all="true"
  data-detail-view="true"
  data-show-export="true"
  data-click-to-select="true"
  data-detail-formatter="detailFormatter"
  data-minimum-count-columns="2"
  data-show-pagination-switch="true"
  data-pagination="true"
  data-id-field="tests_id"
  data-page-list="[10, 25, 50, 100, all]"
  data-show-footer="true"
  data-url="{% url 'Personals-list' %}"
  data-buttons="buttons"
  data-response-handler="responseHandler">
    <thead class="thead-dark">
        <tr>
        <td scope="col" data-field="state" data-checkbox="true"></td>
        <td scope="col" data-field="personal_id" data-searchable="true">Персональный ID</td>
        <td scope="col"></td>
        <td scope="col" data-field="ext_id" data-searchable="true">Расширенный ID</td>
        <td scope="col" data-field="full_name" data-searchable="true">ФИО</td>
        <td scope="col" data-field="birth_date" data-searchable="true">Дата рождения</td>
        <td scope="col" data-field="position" data-searchable="true">Должность</td>
        <td scope="col" data-field="punishment" data-searchable="true">Дисциплинарные зыскания</td>
        <td scope="col" data-field="operate" data-formatter="operateFormatter"
          data-events="operateEvents"></td>
        </tr>
  </thead>
    <tbody class="searchable">
    </tbody>
</table>

<script type="text/javascript">
    var $table = $('#table')
    var $remove = $('#remove')
    var selections = []
    var $button = $('#button')
    var csrftoken = $.cookie('csrftoken');
    function getIdSelections() {
    return $.map($table.bootstrapTable('getSelections'), function (row) {
      return row.personal_id
        })
    }

    // Не отправляет снова формы при обновлении страницы
    if ( window.history.replaceState ) {
    window.history.replaceState( null, null, window.location.href );}

    function responseHandler(res) {
    $.each(res.rows, function (i, row) {
      row.state = $.inArray(row.personal_id, selections) !== -1
    })
    return res
    }

    function detailFormatter(index, row) {
    var html = []
    $.each(row, function (key, value) {
      html.push('<p><b>' + key + ':</b> ' + value + '</p>')
    })
    return html.join('')
    }

    function operateFormatter(value, row, index) {
    return [
      '<a class="like" href="javascript:void(0)" title="Профиль">',
      '<i class="fa fa-id-card" aria-hidden="true"></i>',
      '</a>  ',
      '<a class="remove" href="javascript:void(0)" title="Remove">',
      '<i class="fa fa-trash"></i>',
      '</a>'
    ].join('')
    }

    window.operateEvents = {
    'click .like': function (e, value, row, index) {
        value = [row.personal_id],
        document.location.href = "/card/" + row.personal_id +"/";
    },
    'click .remove': function (e, value, row, index) {
        $.ajax({
          url: "/api/v1/personals/" + row.personal_id +"/",
          method: "delete",
          dataType: "json",
          success: function(){
                 $table.bootstrapTable('remove', {
                 field: 'personal_id',
                 values: [row.personal_id], }),
		         alert("Удалить получилось!");}
          })
    }}

// Функция таблицы
 function initTable() {
    $table.bootstrapTable('destroy').bootstrapTable({
    height: 550,
    locale: $('#locale').val(),
    columns: [
        [{
          field: 'state',
          checkbox: true,
          rowspan: 2,
          align: 'center',
          valign: 'middle'
        },{
            field: 'personal_id',
            title: 'Персональный ID',
            rowspan: 2,
            align: 'center',
            valign: 'middle',
            sortable: true,
             searchable: true
        }, {
          title: 'Детальная информация',
          colspan: 6,
          align: 'center'
        }],
        [{
            field: 'ext_id',
            title: 'Расширенный ID',
            sortable: true,
            align: 'center',
        },{
            field: 'full_name',
            title: 'ФИО',
            sortable: true,
            align: 'center',
        },{
            field: 'birth_date',
            title: 'Дата рождения',
            sortable: true,
            align: 'center',
        },{
            field: 'position',
            title: 'Должность',
            sortable: true,
            align: 'center',
        },{
            field: 'punishment',
            title: 'Дисциплинарные взыскания',
            sortable: true,
            align: 'center',
        },{
            field: 'operate',
            title: 'Профиль/Удалить',
            align: 'center',
            clickToSelect: false,
            events: window.operateEvents,
            formatter: operateFormatter
        }]
       ]
      })

// Функция поиска search
$(document).ready(function () {
    (function ($) {
        $('#filter').keyup(function () {
            var rex = new RegExp($(this).val(), 'i');
            $('.searchable tr').hide();
            $('.searchable tr').filter(function () {
                return rex.test($(this).text());
            }).show();
        })
    }(jQuery));
});

// выбор checkbox
 $table.on('check.bs.table uncheck.bs.table ' +
      'check-all.bs.table uncheck-all.bs.table',
    function () {
      $remove.prop('disabled', !$table.bootstrapTable('getSelections').length)
        selections = getIdSelections()
      })

 $table.on('all.bs.table', function (e, name, args) {
      console.log(name, args)
    })

// функция удаления выбранных рядов
 $remove.click(function () {
               var ids = getIdSelections()
    ids.forEach(function(value, index, ids) {
        $.ajax({
          url: "/api/v1/personals/" + ids[index] +"/",
          method: "delete",
          dataType: "json",
          success: function(){
            $table.bootstrapTable('remove', {
              field: 'personal_id',
              values: ids,
            })
          }
        })
 })
  $remove.prop('disabled', true)
})
}

// установка csrf
function csrfSafeMethod(method) {
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}

$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
});

// dominus
$(function () {
        $("#datetimepicker1").datetimepicker({ locale: 'ru', format: 'YYYY-MM-DD', });
        $("#datetimepicker2").datetimepicker({ locale: 'ru', format: 'YYYY-MM-DD', });
});

// добавление сотрудников
$(function() {
  $("#btn").click(function(){
			var elements = document.getElementById("ajax_form").elements;
            var data = {};
            for(var i = 0 ; i < 7 ; i++){
            var item = elements.item(i);
            data[item.name] = item.value;
		    }

            var csrfmiddlewaretoken = data.csrfmiddlewaretoken
            var ext_id = parseInt(data.ext_id)
            var full_name = data.full_name
            var birth_date = data.birth_date
            var position = data.position
            var punishment = parseInt(data.punishment)

    $.ajax({
        url: "/api/v1/personals/",
        type: "POST",
        dataType: "application/json; charset=utf-8",
        dataType: "json",

        data:          {
                        'ext_id': ext_id,
                        'full_name': full_name,
                        'birth_date': birth_date,
                        'position': position,
                        'punishment': punishment},
        success: function(response) {
        	console.log(JSON.stringify(data));
    	},
    	error: function(response) {
    	  console.log(JSON.stringify(data));

    	}
 	});
 })
})


// изменение метод put
$(function() {

    var checkedRows = [];
    var checkedExt_id = [];
    var checkedFull_name = [];
    var checkedBirth_date = [];
    var checkedPosition = [];
    var checkedPunishment = [];

    // выбор ряда
    $('#table').on('check.bs.table', function (e, row) {
        checkedRows.push({personal_id: row.personal_id});
        checkedExt_id.push({ext_id: row.ext_id});
        checkedFull_name.push({full_name: row.full_name});
        checkedBirth_date.push({birth_date: row.birth_date});
        checkedPosition.push({position: row.position});
        checkedPunishment.push({punishment: row.punishment});
        console.log(checkedRows);
        console.log(checkedExt_id[0].ext_id);

        // вывод в значение формы put по-умолчанию
        document.getElementById("ext_id_put").value = checkedExt_id[0].ext_id
        document.getElementById("full_name_put").value = checkedFull_name[0].full_name
        document.getElementById("birth_date_put").value = checkedBirth_date[0].birth_date
        document.getElementById("position_put").value = checkedPosition[0].position
        document.getElementById("punishment_put").value = checkedPunishment[0].punishment

    });

    $('#table').on('uncheck.bs.table', function (e, row) {
        $.each(checkedRows, function(index, value) {
            if (value.personal_id === row.personal_id) {
                checkedRows.splice(index,1);}
            })

        $.each(checkedExt_id, function(index, value) {
            if (value.ext_id === row.ext_id) {
                checkedExt_id.splice(index,1);}
            })

            $.each(checkedFull_name, function(index, value) {
            if (value.full_name === row.full_name) {
                checkedFull_name.splice(index,1);}
            })

            $.each(checkedBirth_date, function(index, value) {
            if (value.birth_date === row.birth_date) {
                checkedBirth_date.splice(index,1);}
            })

            $.each(checkedPosition, function(index, value) {
            if (value.position === row.position) {
                checkedPosition.splice(index,1);}
            })

            $.each(checkedPunishment, function(index, value) {
            if (value.punishment === row.punishment) {
                checkedPunishment.splice(index,1);}
            });
    });

    $("#btn_put").click(function(){
			var elements = document.getElementById("ajax_put").elements;
            var data = {};
            for(var i = 0 ; i < 7 ; i++){
            var item = elements.item(i);
            data[item.name] = item.value;
		    }

            var ext_id = parseInt(data.ext_id_put)
            var full_name = data.full_name_put
            var birth_date = data.birth_date_put
            var position = data.position_put
            var punishment = parseInt(data.punishment_put)

            console.log(data)

            checkedRows.forEach(function(value, index, checkedRows) {
            $.ajax({
                url: "/api/v1/personals/" + value.personal_id +"/",
                type: "PUT",
                dataType: "application/json; charset=utf-8",
                dataType: "json",
                data: {
                        'ext_id': ext_id,
                        'full_name': full_name,
                        'birth_date': birth_date,
                        'position': position,
                        'punishment': punishment },
                success: function(response) {
        	        console.log(JSON.stringify(data));
                },
                error: function(response) {
                    console.log(JSON.stringify(data))
                }
            })})
    })
})

//запуск функции таблицы и выбор языка
$(function() {
    initTable()
    $('#locale').change(initTable)
 })

// фильтрация и вывод данных через ajax
$('#table').on('load-success.bs.table', function (data) {
  console.log($table.bootstrapTable('getData'))
  var data = $table.bootstrapTable('getData')
  console.log(data)

  // всего сотрудников
    count = data.length
    console.log(count)
    document.getElementById("count").innerHTML = count

  // дисциплинарные взыскания
  var punish_list = []
  $(data).each(function(i){
        punish_list.push(data[i].punishment)
    });
    var sum_punish = punish_list.reduce(function(a, b) { return a + b; }, 0);
     document.getElementById("punish").innerHTML = sum_punish
    console.log(sum_punish)
  })

var names = []
{% for fail in fails %}
    var fail = '{{ fail }}'
    names.push(fail)
{% endfor %}
console.log(names)

$(function() {
    $button.click(function () {
      $table.bootstrapTable('filterBy', {
        full_name: names
      })
    })
  })

</script>
    </main>
  </div>
</div>

</body>
</html>
